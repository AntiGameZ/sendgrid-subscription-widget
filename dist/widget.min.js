/*! sendgrid-subscription-widget - v0.0.1-dev - 2013-10-28 */
!function(){var a={css:!0,messages:!0},b="sendgrid-subscription-widget",c=function(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c};c.prototype=window.CustomEvent.prototype;var d=Object.keys||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)hasOwnProperty.call(a,c)&&b.push(c);return b},e=function(a,b,c){if(null!=a)if(Array.prototype.forEach&&a.forEach===Array.prototype.forEach)a.forEach(b,c);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(c,a[e],e,a)==={})return}else for(var g=d(a),e=0,f=g.length;f>e;e++)if(b.call(c,a[g[e]],g[e],a)==={})return},f=function(a,b,c,d){c=null==c?_.identity:lookupIterator(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},g=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=f(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(Array.prototype.indexOf&&a.indexOf===Array.prototype.indexOf)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},h=function(a){return e(Array.prototype.slice.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},i=function(a,b,c){var d=k();if(d){var e=c?"POST":"GET";d.open(e,a,!0),c&&d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.onreadystatechange=function(){4==d.readyState&&(200==d.status||304==d.status)&&b(d)},4!=d.readyState&&d.send(c)}},j=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],k=function(){for(var a=!1,b=0;b<j.length;b++){try{a=j[b]()}catch(c){continue}break}return a},l=function(a){return"true"===a||"1"===a},m=function(a,b,c){return b.getAttribute("data-"+a)?l(b.getAttribute("data-"+a)):c[a]},n=[];e(document.getElementsByTagName("div"),function(a){var c=a.className.split(" ");-1!==g(c,b)&&n.push(a)}),e(n,function(d){if("true"!==d.getAttribute("data-executed")){if(d.setAttribute("data-executed","true"),m("css",d,a)&&!document.getElementById(b+"-css")){var f=document.createElement("link");f.setAttribute("id",b+"-css"),f.setAttribute("rel","stylesheet"),f.setAttribute("type","text/css"),f.setAttribute("href","https://raw.github.com/nquinlan/sendgrid-subscription-widget/master/dist/widget.min.css"),document.getElementsByTagName("head")[0].appendChild(f)}var j=d.innerHTML;d.innerHTML="";var k=document.createElement("form");k.innerHTML='<div class="response"></div>'+j+'<label><span>Email</span><input type="email" name="email" placeholder="you@example.com"></label><input type="submit" value="submit">',d.appendChild(k);var l={"Your request cannot be processed.":d.getAttribute("data-message-unprocessed")||"Unfortunately, an error occured. Please contact us to subscribe.","The email address is invalid.":d.getAttribute("data-message-invalid")||"The email you provided is not a valid email address. Please fix it and try again.","You have subscribed to this Marketing Email.":d.getAttribute("data-message-success")||"Thanks for subscribing."};k.addEventListener("submit",function(b){var d=h({},b),f=c("submit",d),j=this.parentNode;b.stopPropagation(),b.preventDefault(),j.dispatchEvent(f);var k=j.getAttribute("data-token"),n=document.location.href,o=this.getElementsByTagName("input"),p={};e(o,function(a){var b=a.getAttribute("name"),c="SG_widget["+b+"]";p[c]=a.value}),p.p=k,p.r=n;var q="";e(p,function(a,b){q+="&"+b+"="+encodeURIComponent(a)}),q=q.substr(1),i("https://sendgrid.com/newsletter/addRecipientFromWidget",function(b){var d,f,h=JSON.parse(b.responseText),i={message:h.message,detail:h.detail||h.message},k=j.getElementsByTagName("div"),n=k[0];e(k,function(a){var b=a.className.split(" ");-1!==g(b,"response")&&(n=a)},q),d=h.success===!1?"error":"success",f=c(d,i),m("messages",j,a)&&(n.className=n.className.replace("error","").replace("success","")+" "+d,n.innerText=l[i.message]),j.dispatchEvent(f)},q)});var n=c("ready",{info:"ready"});d.dispatchEvent(n)}})}();