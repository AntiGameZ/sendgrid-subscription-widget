/*! sendgrid-subscription-widget - v0.0.1-dev - 2013-12-16 */
!function(){var a={css:!0,messages:!0},b="sendgrid-subscription-widget",c=function(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c};c.prototype=window.CustomEvent.prototype;var d=Object.keys||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)hasOwnProperty.call(a,c)&&b.push(c);return b},e=function(a){return a},f=function(a,b,c){if(null!=a)if(Array.prototype.forEach&&a.forEach===Array.prototype.forEach)a.forEach(b,c);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(c,a[e],e,a)==={})return}else for(var g=d(a),e=0,f=g.length;f>e;e++)if(b.call(c,a[g[e]],g[e],a)==={})return},g=function(a){return"function"==typeof a?a:function(b){return b[a]}},h=function(a,b,c,d){c=null==c?e:g(c);for(var f=c.call(d,b),h=0,i=a.length;i>h;){var j=h+i>>>1;c.call(d,a[j])<f?h=j+1:i=j}return h},i=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=h(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(Array.prototype.indexOf&&a.indexOf===Array.prototype.indexOf)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},j=function(a){return f(Array.prototype.slice.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},k=function(a,b,c){var d=m();if(d){var e=c?"POST":"GET";d.open(e,a,!0),c&&d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.onreadystatechange=function(){4==d.readyState&&(200==d.status||304==d.status)&&b(d)},4!=d.readyState&&d.send(c)}},l=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],m=function(){for(var a=!1,b=0;b<l.length;b++){try{a=l[b]()}catch(c){continue}break}return a},n=function(a){return"true"===a||"1"===a},o=function(a,b,c){return b.getAttribute("data-"+a)?n(b.getAttribute("data-"+a)):c[a]},p=[];f(document.getElementsByTagName("div"),function(a){var c=a.className.split(" ");-1!==i(c,b)&&p.push(a)}),f(p,function(d){if("true"!==d.getAttribute("data-executed")){if(d.setAttribute("data-executed","true"),o("css",d,a)&&!document.getElementById(b+"-css")){var e=document.createElement("link");e.setAttribute("id",b+"-css"),e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href","https://raw.github.com/nquinlan/sendgrid-subscription-widget/master/dist/widget.min.css"),document.getElementsByTagName("head")[0].appendChild(e)}var g=d.innerHTML;d.innerHTML="";var h=document.createElement("form");h.innerHTML='<div class="response"></div>'+g+'<label><span>Email</span><input type="email" name="email" placeholder="you@example.com"></label><input type="submit" value="submit">',d.appendChild(h);var l={"Your request cannot be processed.":d.getAttribute("data-message-unprocessed")||"Unfortunately, an error occurred. Please contact us to subscribe.","The email address is invalid.":d.getAttribute("data-message-invalid")||"The email you provided is not a valid email address. Please fix it and try again.","You have subscribed to this Marketing Email.":d.getAttribute("data-message-success")||"Thanks for subscribing."};h.addEventListener("submit",function(b){var d=j({},b),e=c("submit",d),g=this.parentNode;b.stopPropagation(),b.preventDefault(),g.dispatchEvent(e);var h=decodeURIComponent(g.getAttribute("data-token")),m=document.location.href,n=this.getElementsByTagName("input"),p={};f(n,function(a){var b=a.getAttribute("name"),c="SG_widget["+b+"]";p[c]=a.value}),p.p=h,p.r=m;var q="";f(p,function(a,b){q+="&"+b+"="+encodeURIComponent(a)}),q=q.substr(1),k("https://sendgrid.com/newsletter/addRecipientFromWidget",function(b){var d,e,h=JSON.parse(b.responseText),j={message:h.message,detail:h.detail||h.message},k=g.getElementsByTagName("div"),m=k[0];f(k,function(a){var b=a.className.split(" ");-1!==i(b,"response")&&(m=a)},q),d=h.success===!1?"error":"success",j.type=d,e=c(d,j),o("messages",g,a)&&(m.className=m.className.replace("error","").replace("success","")+" "+d,m.innerText=l[j.message]),g.dispatchEvent(e)},q)});var m=c("ready",{info:"ready"});d.dispatchEvent(m)}})}();